generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Admin {
  id            Int       @id @default(autoincrement())
  name          String?
  email         String    @unique
  password_hash String
  role          AdminRole @default(super_admin)
  last_login    DateTime? @db.Timestamp(0)
  created_at    DateTime? @default(now()) @db.Timestamp(0)

  login_logs    AdminLoginLog[]
  activity_logs AdminActivityLog[]

  @@map("admins")
}

model Customer {
  id           Int           @id @default(autoincrement())
  name         String?
  email        String?       @unique
  phone        String?
  whatsapp     String?
  notes        String?       @db.Text
  ltv          Decimal?      @default(0.00) @db.Decimal(10, 2)
  source       String?       @default("Website")
  score        CustomerScore @default(cold)
  stage        CustomerStage @default(new)
  tags         Json?
  owner        String?       @default("unassigned")
  created_at   DateTime?     @default(now()) @db.Timestamp(0)
  updated_at   DateTime?     @default(now()) @updatedAt @db.Timestamp(0)

  facebook_lead_id String?       @unique
  ad_data      Json?

  orders       Order[]
  interactions Interaction[]
  tasks        Task[]
  files        File[]

  @@map("customers")
}

model Order {
  id                  Int             @id @default(autoincrement())
  customer_id         Int?
  razorpay_order_id   String?
  razorpay_payment_id String?
  amount              Decimal?        @db.Decimal(10, 2)
  currency            String?         @default("INR")
  source              String?         @default("Website")
  status              OrderStatus     @default(initiated)
  invoice_url         String?         @db.VarChar(500)
  proposal_status     ProposalStatus  @default(draft)
  payment_mode        String?
  due_date            DateTime?       @db.DateTime(0)
  created_at          DateTime?       @default(now()) @db.Timestamp(0)
  updated_at          DateTime?       @default(now()) @updatedAt @db.Timestamp(0)

  customer            Customer?       @relation(fields: [customer_id], references: [id])
  project_submission  ProjectSubmission[]
  interactions        Interaction[]
  tasks               Task[]

  @@map("orders")
}

model ProjectSubmission {
  id              Int       @id @default(autoincrement())
  order_id        Int?
  brand_name      String?
  assets_url      String?   @db.VarChar(500)
  raw_data_json   Json?
  submission_date DateTime? @default(now()) @db.Timestamp(0)

  order           Order?    @relation(fields: [order_id], references: [id], onDelete: Cascade)

  @@map("project_submissions")
}

model Interaction {
  id          Int                  @id @default(autoincrement())
  customer_id Int?
  order_id    Int?
  type        InteractionType
  content     String?              @db.Text
  sentiment   InteractionSentiment @default(neutral)
  created_by  Int?
  created_at  DateTime?            @default(now()) @db.Timestamp(0)

  customer    Customer?            @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  order       Order?               @relation(fields: [order_id], references: [id])

  @@map("interactions")
}

model Task {
  id               Int          @id @default(autoincrement())
  customer_id      Int?
  related_order_id Int?
  assigned_to      Int?
  title            String
  description      String?      @db.Text
  due_date         DateTime?    @db.Timestamp(0)
  status           TaskStatus   @default(open)
  priority         TaskPriority @default(medium)
  created_at       DateTime?    @default(now()) @db.Timestamp(0)

  customer         Customer?    @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  order            Order?       @relation(fields: [related_order_id], references: [id])

  @@map("tasks")
}

model File {
  id          Int       @id @default(autoincrement())
  customer_id Int?
  uploaded_by Int?
  file_name   String
  file_url    String    @db.VarChar(500)
  file_type   String?   @default("link")
  created_at  DateTime? @default(now()) @db.Timestamp(0)

  customer    Customer? @relation(fields: [customer_id], references: [id], onDelete: Cascade)

  @@map("files")
}

model AdminLoginLog {
  id          Int       @id @default(autoincrement())
  admin_id    Int?
  ip_address  String?   @db.VarChar(45)
  user_agent  String?   @db.Text
  login_time  DateTime? @default(now()) @db.Timestamp(0)
  success     Boolean?  @default(true)

  admin       Admin?    @relation(fields: [admin_id], references: [id], onDelete: Cascade)

  @@map("admin_login_logs")
}

model AdminActivityLog {
  id                 Int       @id @default(autoincrement())
  admin_id           Int?
  action_type        String?   @db.VarChar(50)
  action_description String?   @db.Text
  entity_type        String?   @db.VarChar(50)
  entity_id          Int?
  created_at         DateTime? @default(now()) @db.Timestamp(0)

  admin              Admin?    @relation(fields: [admin_id], references: [id], onDelete: Cascade)

  @@map("admin_activity_logs")
}

enum AdminRole {
  super_admin
  support
}

enum CustomerScore {
  hot
  warm
  cold
}

enum CustomerStage {
  new
  contacted
  qualified
  proposal_sent
  negotiation
  won
  lost
}

enum OrderStatus {
  initiated
  payment_failed
  paid
  onboarding_pending
  processing
  delivered
  cancelled
}

enum ProposalStatus {
  draft
  sent
  accepted
  declined
}

enum InteractionType {
  call_log
  email_sent
  whatsapp_msg
  internal_note
  system_event
}

enum InteractionSentiment {
  positive
  neutral
  negative
}

enum TaskStatus {
  open
  in_progress
  done
}

enum TaskPriority {
  high
  medium
  low
}

model SystemSetting {
  id          String   @id @default(uuid())
  key         String   @unique
  value       String   @db.Text
  description String?
  updated_at  DateTime @default(now()) @updatedAt

  @@map("system_settings")
}
