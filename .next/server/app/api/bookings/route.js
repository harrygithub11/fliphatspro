(()=>{var e={};e.id=1946,e.ids=[1946],e.modules={13878:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=13878,e.exports=t},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},41808:e=>{"use strict";e.exports=require("net")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},39512:e=>{"use strict";e.exports=require("timers")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},3086:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>S,patchFetch:()=>O,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>_,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>E});var s={};r.r(s),r.d(s,{GET:()=>u,POST:()=>d});var o=r(95419),i=r(69108),a=r(99678),n=r(78070),c=r(47033);async function u(){try{let e=await c.Z.getConnection(),[t]=await e.execute(`
            SELECT 
                c.id, c.name, c.email, c.phone, c.created_at as submittedAt,
                o.status, o.amount, o.source,
                (SELECT content FROM interactions WHERE customer_id = c.id ORDER BY created_at DESC LIMIT 1) as last_interaction
            FROM customers c
            LEFT JOIN orders o ON c.id = o.customer_id
            ORDER BY c.created_at DESC
        `);e.release();let r=t.map(e=>({id:e.id.toString(),name:e.name,email:e.email,phone:e.phone||"",store:e.store,submittedAt:e.submittedAt,status:e.stage||"new"}));return n.Z.json(r)}catch(e){return console.error("Failed to fetch bookings:",e),n.Z.json({error:"Failed to fetch bookings"},{status:500})}}async function d(e){try{let t=await e.json(),{name:r,email:s,phone:o,store:i,source:a}=t;if(!r||!s)return n.Z.json({error:"Name and email are required"},{status:400});let u=await c.Z.getConnection();try{let[e]=await u.execute(`INSERT INTO customers (name, email, phone, source, stage, score, tags, notes, created_at) 
                 VALUES (?, ?, ?, 'Strategy Call', 'new', 'warm', ?, ?, NOW())`,[r,s,o||"",JSON.stringify(["booking_form"]),i||""]),d=e.insertId;await u.execute(`INSERT INTO interactions (type, customer_id, content, created_at) 
                 VALUES ('system_event', ?, ?, NOW())`,[d,JSON.stringify({source:"booking_form",action:"form_submitted",...t})]),u.release();let l=null;if("lifetime_12k"===a||"newyear_5k"===a){let e="lifetime_12k"===a?12e3:5e3,t=await c.Z.getConnection();try{let[r]=await t.execute("INSERT INTO orders (customer_id, amount, status, source, razorpay_order_id, proposal_status) VALUES (?, ?, ?, ?, ?, ?)",[d,e,"initiated",a,`DEAL_${Date.now()}`,"draft"]);l=r.insertId,await t.execute(`INSERT INTO interactions (type, customer_id, content, created_at) 
                         VALUES ('system_event', ?, ?, NOW())`,[d,JSON.stringify({source:"system",action:"auto_deal_created",amount:e})])}catch(e){console.error("Failed to auto-create deal:",e)}finally{t.release()}}return n.Z.json({success:!0,booking:{id:d.toString(),name:r,email:s,phone:o,store:i,submittedAt:new Date().toISOString(),status:"new",dealId:l}})}catch(e){throw u.release(),e}}catch(e){return console.error("Failed to save booking:",e),n.Z.json({success:!1,error:"ER_DUP_ENTRY"===e.code?"Email already exists":"Failed to save booking"},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/bookings/route",pathname:"/api/bookings",filename:"route",bundlePath:"app/api/bookings/route"},resolvedPagePath:"C:\\Users\\MISHTY5626\\Desktop\\Webhost\\newyearlp\\app\\api\\bookings\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:_,headerHooks:g,staticGenerationBailout:E}=l,S="/api/bookings/route";function O(){return(0,a.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:m})}},47033:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=r(63069).createPool({host:process.env.DB_HOST||"127.0.0.1",port:parseInt(process.env.DB_PORT||"3307"),user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"admin",database:process.env.DB_NAME||"newyear",waitForConnections:!0,connectionLimit:10,queueLimit:0})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1638,6206,3069],()=>r(3086));module.exports=s})();