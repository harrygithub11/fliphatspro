(()=>{var e={};e.id=9649,e.ids=[9649,3205],e.modules={13878:e=>{function s(e){var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}s.keys=()=>[],s.resolve=s,s.id=13878,e.exports=s},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},41808:e=>{"use strict";e.exports=require("net")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},39512:e=>{"use strict";e.exports=require("timers")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},11055:(e,s,t)=>{"use strict";t.r(s),t.d(s,{headerHooks:()=>x,originalPathname:()=>f,patchFetch:()=>q,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>w});var r={};t.r(r),t.d(r,{POST:()=>d});var a=t(95419),n=t(69108),i=t(99678),o=t(78070),u=t(47033),c=t(3205),p=t(7529);async function d(e){try{let s=await (0,c.getSession)();if(!s)return o.Z.json({error:"Unauthorized"},{status:401});let{currentPassword:t,newPassword:r}=await e.json();if(!t||!r)return o.Z.json({success:!1,message:"Missing required fields"},{status:400});if(r.length<8)return o.Z.json({success:!1,message:"Password must be at least 8 characters"},{status:400});let a=await u.Z.getConnection();try{let[e]=await a.execute("SELECT password_hash FROM admins WHERE id = ?",[s.id]);if(0===e.length)return o.Z.json({success:!1,message:"Admin not found"},{status:404});if(!await p.ZP.compare(t,e[0].password_hash))return o.Z.json({success:!1,message:"Current password is incorrect"},{status:401});let n=await p.ZP.hash(r,10);return await a.execute("UPDATE admins SET password_hash = ? WHERE id = ?",[n,s.id]),o.Z.json({success:!0,message:"Password changed successfully"})}finally{a.release()}}catch(e){return console.error("Change Password Error:",e),o.Z.json({success:!1,message:"Failed to change password"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/profile/change-password/route",pathname:"/api/admin/profile/change-password",filename:"route",bundlePath:"app/api/admin/profile/change-password/route"},resolvedPagePath:"C:\\Users\\MISHTY5626\\Desktop\\Webhost\\newyearlp\\app\\api\\admin\\profile\\change-password\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:g,headerHooks:x,staticGenerationBailout:w}=l,f="/api/admin/profile/change-password/route";function q(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},3205:(e,s,t)=>{"use strict";t.d(s,{ed:()=>o,getSession:()=>u});var r=t(79616),a=t(31865),n=t(7439);let i=new TextEncoder().encode(process.env.JWT_SECRET||"your-secret-key-change-in-production");async function o(e){let s=await new r.N({admin:e}).setProtectedHeader({alg:"HS256"}).setExpirationTime("24h").sign(i);return(0,n.cookies)().set("admin_session",s,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:86400,path:"/"}),s}async function u(){let e=n.cookies().get("admin_session")?.value;if(!e)return null;try{let{payload:s}=await (0,a._)(e,i);return s.admin}catch(e){return null}}},47033:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});let r=t(63069).createPool({host:process.env.DB_HOST||"127.0.0.1",port:parseInt(process.env.DB_PORT||"3307"),user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"admin",database:process.env.DB_NAME||"newyear",waitForConnections:!0,connectionLimit:10,queueLimit:0})}};var s=require("../../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[1638,6206,3069,1376,7529],()=>t(11055));module.exports=r})();