(()=>{var e={};e.id=5540,e.ids=[5540],e.modules={13878:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=13878,e.exports=t},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},41808:e=>{"use strict";e.exports=require("net")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},39512:e=>{"use strict";e.exports=require("timers")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},86542:(e,t,s)=>{"use strict";s.r(t),s.d(t,{headerHooks:()=>x,originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>E,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>_});var r={};s.r(r),s.d(r,{GET:()=>u,PUT:()=>d});var a=s(95419),i=s(69108),n=s(99678),o=s(78070),c=s(47033);async function u(e,{params:t}){try{let e=t.id,s=await c.Z.getConnection();try{let[t]=await s.execute("SELECT * FROM customers WHERE id = ?",[e]);if(0===t.length)return o.Z.json({success:!1,message:"Lead not found"},{status:404});let r=t[0],[a]=await s.execute("SELECT * FROM orders WHERE customer_id = ? ORDER BY created_at DESC",[e]),[i]=await s.execute(`SELECT i.*, a.name as created_by_name, a.email as created_by_email 
                 FROM interactions i 
                 LEFT JOIN admins a ON i.created_by = a.id 
                 WHERE i.customer_id = ? 
                 ORDER BY i.created_at DESC`,[e]),[n]=await s.execute("SELECT * FROM tasks WHERE customer_id = ? ORDER BY due_date ASC",[e]),[c]=await s.execute("SELECT * FROM files WHERE customer_id = ? ORDER BY created_at DESC",[e]);return o.Z.json({success:!0,data:{profile:r,deals:a,timeline:i,tasks:n,files:c}})}finally{s.release()}}catch(e){return console.error("Fetch Lead 360 Error:",e),o.Z.json({success:!1,message:"Server error"},{status:500})}}async function d(e,{params:t}){try{let r=await e.json(),a=t.id,{id:i,created_at:n,...u}=r;if(0===Object.keys(u).length)return o.Z.json({success:!1,message:"No fields to update"});let d=Object.keys(u),l=Object.values(u),p=d.map(e=>`${e} = ?`).join(", "),m=`UPDATE customers SET ${p} WHERE id = ?`,E=await c.Z.getConnection();try{let{getSession:e}=await Promise.all([s.e(1376),s.e(3205)]).then(s.bind(s,3205)),t=await e();if(await E.execute(m,[...l,a]),u.owner&&t){await E.execute(`INSERT INTO interactions (customer_id, type, content, created_by, created_at) 
                     VALUES (?, 'system_event', ?, ?, NOW())`,[a,`Assigned lead to ${u.owner}`,t.id]);let{logAdminActivity:e}=await s.e(9629).then(s.bind(s,79629));await e(t.id,"lead_assignment",`Assigned lead to ${u.owner}`,"customer",parseInt(a))}if(t&&Object.keys(u).length>0){let{logAdminActivity:e}=await s.e(9629).then(s.bind(s,79629)),r=Object.keys(u).join(", ");await e(t.id,"lead_update",`Updated lead fields: ${r}`,"customer",parseInt(a))}return o.Z.json({success:!0})}finally{E.release()}}catch(e){return console.error("Update Lead Error:",e),o.Z.json({success:!1,message:"Update failed"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/leads/[id]/route",pathname:"/api/admin/leads/[id]",filename:"route",bundlePath:"app/api/admin/leads/[id]/route"},resolvedPagePath:"C:\\Users\\MISHTY5626\\Desktop\\Webhost\\newyearlp\\app\\api\\admin\\leads\\[id]\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:E,headerHooks:x,staticGenerationBailout:_}=l,y="/api/admin/leads/[id]/route";function w(){return(0,n.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:m})}},47033:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=s(63069).createPool({host:process.env.DB_HOST||"127.0.0.1",port:parseInt(process.env.DB_PORT||"3307"),user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"admin",database:process.env.DB_NAME||"newyear",waitForConnections:!0,connectionLimit:10,queueLimit:0})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[1638,6206,3069],()=>s(86542));module.exports=r})();