(()=>{var e={};e.id=319,e.ids=[319],e.modules={13878:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=13878,e.exports=r},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},41808:e=>{"use strict";e.exports=require("net")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},39512:e=>{"use strict";e.exports=require("timers")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},66789:(e,r,t)=>{"use strict";t.r(r),t.d(r,{headerHooks:()=>O,originalPathname:()=>R,patchFetch:()=>w,requestAsyncStorage:()=>p,routeModule:()=>E,serverHooks:()=>_,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>x});var s={};t.r(s),t.d(s,{DELETE:()=>l,GET:()=>u,POST:()=>d});var o=t(95419),i=t(69108),a=t(99678),n=t(78070),c=t(47033);async function u(e,{params:r}){try{let e=r.id,t=await c.Z.getConnection();try{let[r]=await t.execute(`
                SELECT 
                    o.*,
                    c.name as customer_name, c.email as customer_email, c.phone as customer_phone, c.ltv, c.notes as customer_notes
                FROM orders o
                LEFT JOIN customers c ON o.customer_id = c.id
                WHERE o.id = ?
            `,[e]);if(0===r.length)return n.Z.json({error:"Order not found"},{status:404});let s=r[0],[o]=await t.execute("SELECT * FROM project_submissions WHERE order_id = ?",[e]),[i]=await t.execute(`SELECT i.*, a.name as created_by_name, a.email as created_by_email 
                 FROM interactions i 
                 LEFT JOIN admins a ON i.created_by = a.id 
                 WHERE i.order_id = ? 
                 ORDER BY i.created_at DESC`,[e]),[a]=await t.execute("SELECT * FROM tasks WHERE related_order_id = ? ORDER BY created_at DESC",[e]);return n.Z.json({order:s,submission:o[0]||null,interactions:i,tasks:a})}finally{t.release()}}catch(e){return console.error("Fetch Order Detail Error:",e),n.Z.json({error:"Server error"},{status:500})}}async function d(e,{params:r}){try{let t=r.id,{content:s,type:o}=await e.json();if(!s)return n.Z.json({error:"Content required"},{status:400});let i=await c.Z.getConnection();try{let[e]=await i.execute("SELECT customer_id FROM orders WHERE id = ?",[t]);if(0===e.length)return n.Z.json({error:"Order not found"},{status:404});let r=e[0].customer_id,a=o||"internal_note",[c]=await i.execute("INSERT INTO interactions (type, order_id, customer_id, content, created_at) VALUES (?, ?, ?, ?, NOW())",[a,t,r,s]),u={id:c.insertId,type:a,order_id:t,customer_id:r,content:s,created_at:new Date().toISOString()};return n.Z.json(u)}finally{i.release()}}catch(e){return console.error("Create Interaction Error:",e),n.Z.json({error:"Failed to create note"},{status:500})}}async function l(e,{params:r}){try{let e=r.id,t=await c.Z.getConnection();try{return await t.beginTransaction(),await t.execute("DELETE FROM interactions WHERE order_id = ?",[e]),await t.execute("DELETE FROM tasks WHERE related_order_id = ?",[e]),await t.execute("DELETE FROM project_submissions WHERE order_id = ?",[e]),await t.execute("DELETE FROM orders WHERE id = ?",[e]),await t.commit(),n.Z.json({success:!0})}catch(e){throw await t.rollback(),e}finally{t.release()}}catch(e){return console.error("Delete Order Error:",e),n.Z.json({error:"Failed to delete order"},{status:500})}}let E=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/orders/[id]/route",pathname:"/api/admin/orders/[id]",filename:"route",bundlePath:"app/api/admin/orders/[id]/route"},resolvedPagePath:"C:\\Users\\MISHTY5626\\Desktop\\Webhost\\newyearlp\\app\\api\\admin\\orders\\[id]\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:_,headerHooks:O,staticGenerationBailout:x}=E,R="/api/admin/orders/[id]/route";function w(){return(0,a.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:m})}},47033:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});let s=t(63069).createPool({host:process.env.DB_HOST||"127.0.0.1",port:parseInt(process.env.DB_PORT||"3307"),user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"admin",database:process.env.DB_NAME||"newyear",waitForConnections:!0,connectionLimit:10,queueLimit:0})}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,6206,3069],()=>t(66789));module.exports=s})();