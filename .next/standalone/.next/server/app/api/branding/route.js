(()=>{var e={};e.id=4724,e.ids=[4724],e.modules={13878:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=13878,e.exports=t},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},41808:e=>{"use strict";e.exports=require("net")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},39512:e=>{"use strict";e.exports=require("timers")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},66278:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>_,originalPathname:()=>E,patchFetch:()=>w,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>g});var s={};r.r(s),r.d(s,{POST:()=>u});var a=r(95419),i=r(69108),o=r(99678),n=r(78070),c=r(47033);async function u(e){try{let t=await e.json(),{paymentId:s,adminEmail:a,brandName:i,adminName:o,adminPhone:u}=t,d={...t},p=await c.Z.getConnection();try{await p.beginTransaction();let[e]=await p.execute("SELECT id, customer_id FROM orders WHERE razorpay_payment_id = ?",[s]),t=null,r=null;if(e.length>0)t=e[0].id,r=e[0].customer_id,await p.execute("INSERT INTO project_submissions (order_id, brand_name, raw_data_json) VALUES (?, ?, ?)",[t,i||"Untitled",JSON.stringify(d)]),await p.execute("UPDATE orders SET status = ?, onboarding_status = ? WHERE id = ?",["processing","completed",t]),await p.execute("INSERT INTO interactions (type, order_id, customer_id, content) VALUES (?, ?, ?, ?)",["system_event",t,r,JSON.stringify({source:"direct_onboarding",action:"lead_capture"})]);else{console.log("Creating new Lead/Order for orphan submission");let e=a||"unknown@lead.com",[s]=await p.execute("SELECT id FROM customers WHERE email = ?",[e]);if(s.length>0)r=s[0].id,u&&await p.execute("UPDATE customers SET phone = ? WHERE id = ?",[u,r]);else{let[t]=await p.execute("INSERT INTO customers (name, email, phone, source, stage, score) VALUES (?, ?, ?, ?, ?, ?)",[o||i||"New Lead",e,u||"","Onboarding Form","new","warm"]);r=t.insertId}let n=`MANUAL_${Date.now()}`,[c]=await p.execute("INSERT INTO orders (customer_id, razorpay_order_id, razorpay_payment_id, amount, status, currency, created_at) VALUES (?, ?, ?, ?, ?, ?, NOW())",[r,`lead_${Date.now()}`,n,0,"onboarding_pending","INR"]);t=c.insertId,await p.execute("INSERT INTO project_submissions (order_id, brand_name, raw_data_json) VALUES (?, ?, ?)",[t,i||"Untitled",JSON.stringify(d)]),await p.execute("UPDATE orders SET onboarding_status = ?, status = ? WHERE id = ?",["completed","processing",t]),await p.execute("INSERT INTO interactions (type, order_id, customer_id, content) VALUES (?, ?, ?, ?)",["system_event",t,r,JSON.stringify({source:"direct_onboarding",action:"lead_capture"})]),await p.execute("INSERT INTO tasks (title, description, priority, status, related_order_id) VALUES (?, ?, ?, ?, ?)",[`Review Onboarding: ${i||"New Brand"}`,"Verify brand assets, legal details, and product catalog.","high","open",t])}return await p.commit(),n.Z.json({success:!0,message:"Submission saved"})}catch(s){await p.rollback(),console.error("Database Transaction Error:",s);let e=r(57147),t=r(71017).join(process.cwd(),"db_error_log.txt");return e.writeFileSync(t,`Time: ${new Date().toISOString()}
Error: ${s.message}
Stack: ${s.stack}
Details: ${JSON.stringify(s)}

`,{flag:"a"}),n.Z.json({success:!1,error:s.message||"Database error",details:s.sqlMessage},{status:500})}finally{p.release()}}catch(e){return console.error("Request Processing Error:",e),n.Z.json({success:!1,error:"Failed to process request: "+e.message},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/branding/route",pathname:"/api/branding",filename:"route",bundlePath:"app/api/branding/route"},resolvedPagePath:"C:\\Users\\MISHTY5626\\Desktop\\Webhost\\newyearlp\\app\\api\\branding\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:l,serverHooks:m,headerHooks:_,staticGenerationBailout:g}=d,E="/api/branding/route";function w(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}},47033:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=r(63069).createPool({host:process.env.DB_HOST||"127.0.0.1",port:parseInt(process.env.DB_PORT||"3307"),user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"admin",database:process.env.DB_NAME||"newyear",waitForConnections:!0,connectionLimit:10,queueLimit:0})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1638,6206,3069],()=>r(66278));module.exports=s})();